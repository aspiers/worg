<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.34 in css mode. -->
<html>
  <head>
    <title>drift.org</title>
    <style type="text/css">
    <!--
      body {
        color: #bebebe;
        background-color: #262626;
      }
      .comment {
        /* font-lock-comment-face */
        color: #add8e6;
      }
      .italic {
        /* italic */
        color: #87ceeb;
      }
      .org-block {
        /* org-block */
        color: #b3b3b3;
      }
      .org-code {
        /* org-code */
        color: #b3b3b3;
      }
      .org-footnote {
        /* org-footnote */
        color: #00ffff;
        text-decoration: underline;
      }
      .org-hide {
        /* org-hide */
        color: #262626;
      }
      .org-level-1 {
        /* org-level-1 */
        color: #7fffd4;
        font-weight: bold;
      }
      .org-level-2 {
        /* org-level-2 */
        color: #40e0d0;
        font-weight: bold;
      }
      .org-link {
        /* org-link */
        color: #00ffff;
      }
      .org-meta-line {
        /* org-meta-line */
        color: #add8e6;
      }
      .org-tag {
        /* org-tag */
        font-weight: bold;
      }
      .org-todo {
        /* org-todo */
        color: #ffc0cb;
        font-weight: bold;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="org-meta-line">#+title: Genetic drift</span>
<span class="org-meta-line">#+seq_todo: TODO | DONE</span>
<span class="org-meta-line">#+property: cache no</span>

<span class="org-level-1">* A simple model of evolution</span>
  Evolution is the result of changes in the genetic composition of
  populations over time. One of the simplest models of evolution is as
  follows. There is a population of N individuals, among which there
  are two genetic types: red and blue<span class="org-footnote">[fn:1]</span>. Here is the initial
  generation of the population (N=10).

<span class="org-meta-line">#+begin_src ditaa :file drift-1-gen.png :cmdline -r :exports both
</span><span class="org-block">                  /----+ /----+ /----+ /----+ /----+ /----+ /----+ /----+ /----+ /----+
  Generation 1    |cRED| |cBLU| |cBLU| |cBLU| |cRED| |cRED| |cBLU| |cRED| |cRED| |cRED|
                  |    | |    | |    | |    | |    | |    | |    | |    | |    | |    |
                  +----/ +----/ +----/ +----/ +----/ +----/ +----/ +----/ +----/ +----/  </span><span class="org-meta-line">
#+end_src</span>

<span class="org-meta-line">#+results:</span>
<img src='drift-1-gen.png'/>

  There is no mutation, no selection and no sex; the next generation
  is made up by randomly choosing 10 individuals from the previous
  generation<span class="org-footnote">[fn:2]</span>. A single individual can be chosen more than once,
  or not at all; the number of times an individual is chosen
  corresponds to the number of progeny it has in the next
  generation. Even without mutation or natural selection the
  proportions of red and blue types will change, because different
  individuals will have different numbers of offspring, by chance.

  So the first two generations might look like this.

<span class="org-meta-line">#+begin_src ditaa :file drift-2-gen.png :cmdline -r :exports both
</span><span class="org-block">                  /----+ /----+ /----+ /----+ /----+ /----+ /----+ /----+ /----+ /----+
  Generation 1    |cRED| |cBLU| |cBLU| |cBLU| |cRED| |cRED| |cBLU| |cRED| |cRED| |cRED|              
                  |    | |    | |    | |    | |    | |    | |    | |    | |    | |    |
                  +----/ +----/ +----/ +----/ +----/ +----/ +----/ +----/ +----/ +----/ 
                  /----+ /----+ /----+ /----+ /----+ /----+ /----+ /----+ /----+ /----+
  Generation 2    |cBLU| |cBLU| |cRED| |cRED| |cRED| |cBLU| |cRED| |cRED| |cBLU| |cBLU|              
                  |    | |    | |    | |    | |    | |    | |    | |    | |    | |    |
                  +----/ +----/ +----/ +----/ +----/ +----/ +----/ +----/ +----/ +----/ </span><span class="org-meta-line">
#+end_src</span>

<span class="org-meta-line">#+results:</span>
<img src='drift-2-gen.png'/>


  This is a form of evolution called "genetic drift". It is inevitable,
  although if the population is very large it will have less effect.

  Let X_t be the number of red individuals in generation t, and let p_t
  be the proportion of red individuals. So X_1 is 6 and p_1 is 0.6. To
  choose the number of red individuals in generation 2 we make 10
  choices, each time having probability 6/10 of getting a red
  individual. So X_2 is a <span class="italic">/binomial/</span> random variable, with 10 trials and
  success probability 0.6. In general, the random process is described
  by the following transition probabilities.

<span class="org-meta-line">#+begin_src latex :file transprob.png
</span><span class="org-block">  \begin{equation}
  \Pr(X_t=j|X_{t-1}=i) = \frac{j(j-1)}{2}\Big(\frac{i}{N}\Big)^j\Big(\frac{N-i}{N}\Big)^{n-j}
  \end{equation}</span><span class="org-meta-line">
#+end_src</span>

<span class="org-meta-line">#+results:</span>
<img src='transprob.png'/>

  We can simulate the evolution over many generations in R. This code
  simulates the change in frequency in a single population over 100
  generations. We'll make the population larger (N=1000) but still
  start off with 60% red individuals.

<span class="org-meta-line">#+source: simpledrift(N=1000, X1=600, ngens=100)</span>
<span class="org-meta-line">#+begin_src R :file simpledrift.png :exports code
</span><span class="org-block">  p &lt;- numeric(ngens)
  p[1] &lt;- X1/N
  for(g in 2:ngens)
      p[g] &lt;- rbinom(1, size=N, prob=p[g-1]) / N
  plot(p, type="l", ylim=c(0,1), xlab="Generation", ylab="Proportion red")</span><span class="org-meta-line">
#+end_src</span>

<span class="org-meta-line">#+results[03be...]: simpledrift</span>
<img src='simpledrift.png'/>

  But how variable is this process? To answer this we need to repeat
  the simulation many times (i.e. simulate many identical but
  independent populations). We could do that as follows

<span class="org-meta-line">#+begin_src R :session t
</span><span class="org-block">  drift.slow &lt;- function(N, X1, ngens, nreps) {
      p &lt;- matrix(NA, nrow=ngens, ncol=nreps)
      p[1,] &lt;- X1/N
      for(rep in 1:nreps) {
          for(g in 2:ngens)
              p[g,rep] &lt;- rbinom(1, size=N, prob=p[g-1,rep]) / N
      }
      p
  }</span><span class="org-meta-line">
#+end_src</span>

  But this is not a good implementation. One should make use of
  "vectorisation", which makes the simulation much more efficient when
  there are many replicates<span class="org-footnote">[fn:3]</span>. Note the way that rbinom simulates
  all replicates at once, but still one generation at a time.

<span class="org-meta-line">#+begin_src R :session t
</span><span class="org-block">  drift.faster &lt;- function(N, X1, ngens, nreps) {
      p &lt;- matrix(NA, nrow=ngens, ncol=nreps)
      p[1,] &lt;- X1/N
      for(gen in 2:ngens)
          p[gen,] &lt;- rbinom(n=nreps, size=N, prob=p[gen-1,]) / N
      p
  }</span><span class="org-meta-line">
#+end_src</span>

  To run the simulation:

<span class="org-meta-line">#+source: drift(N=1000, X1=600, nreps=10, ngens=100)</span>
<span class="org-meta-line">#+begin_src R :session t :file repdrift.png :exports code
</span><span class="org-block">  p &lt;- drift.faster(N, X1, ngens, nreps)
  matplot(p, type="l", ylim=c(0,1), lty=1)</span><span class="org-meta-line">
#+end_src</span>

<span class="org-meta-line">#+results[685a...]: drift</span>
<img src='repdrift.png'/>
  And let's quickly see how much of a speed difference the vectorisation
  makes.

<span class="org-meta-line">#+source: compare-times(N=1000, X1=600, nreps=1000, ngens=100)</span>
<span class="org-meta-line">#+begin_src R :session t :colnames t :results output
</span><span class="org-block">  functions &lt;- c(drift.slow=drift.slow, drift.faster=drift.faster)
  times &lt;- sapply(functions, function(f) as.numeric(system.time(f(N, X1, ngens, nreps))[1]))
  print(times)
  cat(sprintf("\nFactor speed-up = %.1f\n", times[1] / times[2]))</span><span class="org-meta-line">
#+end_src</span>

<span class="org-meta-line">#+results[ba4b...]: compare-times</span>
  <span class="org-code">:   drift.slow drift.faster 
</span>  <span class="org-code">:        6.064        0.204
</span>  <span class="org-code">: 
</span>  <span class="org-code">: Factor speed-up = 29.7
</span>
<span class="org-level-1">* Footnotes</span>

  <span class="org-footnote">[fn:1]</span> Every individual is chacterised by a single type; no sex,
  recombination, mutation, selection, etc.

  <span class="org-footnote">[fn:2]</span> All members of the previous generation die as the next
  generation is formed.

  <span class="org-footnote">[fn:3]</span> Note that we can't vectorise the entire simulation because
  drift is a Markov process.

<span class="org-level-1">* Config                                                           </span><span class="org-level-1"><span class="org-tag">:noexport:</span></span>
<span class="org-meta-line">#+options: author:nil date:nil num:nil toc:nil</span>
<span class="org-meta-line">#+latex_header: \usepackage{amsmath}</span>
<span class="org-meta-line">#+latex_header: \usepackage[left=2cm,top=2cm,right=3cm,head=2cm,foot=2cm]{geometry}</span>
<span class="org-meta-line">#+latex_header: \newcommand{\Pr}{\text{Pr}}</span>
<span class="org-meta-line">#+latex_header: \newcommand{\pipe}{\arrowvert}</span>

<span class="comment"># Local Variables&#58;</span>
<span class="comment"># org-export-latex-image-default-option: "width=30em"</span>
<span class="comment"># End:</span>
<span class="org-level-1">* Tasks                                                            </span><span class="org-level-1"><span class="org-tag">:noexport:</span></span>
<span class="org-hide">**</span><span class="org-level-2">* </span><span class="org-todo">TODO</span><span class="org-level-2"> How do we put titles on figures?</span>
<span class="org-hide">**</span><span class="org-level-2">* </span><span class="org-todo">TODO</span><span class="org-level-2"> Connect daughters to parents with lines</span>

</pre>
  </body>
</html>
